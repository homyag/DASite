{% extends "base.html" %}
{% load webpack_loader static %}
{% block title %}
    {{ post.meta_title|default:post.title }} - Boldrise Agency
{% endblock %}
{% block meta_description %}{{ post.meta_description|default:post.preview_text|truncatechars:160 }}{% endblock %}
{% block schema %}
    <!-- Schema.org разметка для статьи -->
    <script type="application/ld+json">
        {
          "@context": "https://schema.org",
          "@type": "BlogPosting",
          "headline": "{{ post.title }}",
          "image": "{{ request.scheme }}://{{ request.get_host }}{{ post.featured_image.url }}",
          "datePublished": "{{ post.created_at|date:'c' }}",
          "dateModified": "{{ post.updated_at|date:'c' }}",
          "author": {
            "@type": "Person",
            "name": "{{ post.author.get_full_name }}"
          },
          "publisher": {
            "@type": "Organization",
            "name": "Boldrise Agency",
            "logo": {
              "@type": "ImageObject",
              "url": "{{ request.scheme }}://{{ request.get_host }}{% static 'vendors/images/logo.png' %}"
            }
          },
          "description": "{{ post.meta_description|default:post.preview_text }}",
          "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "{{ request.scheme }}://{{ request.get_host }}{{ post.get_absolute_url }}"
          }
        }
    </script>

    <!-- Schema.org разметка для хлебных крошек (отдельный блок) -->
    <script type="application/ld+json">
        {
          "@context": "https://schema.org",
          "@type": "BreadcrumbList",
          "itemListElement": [
            {
              "@type": "ListItem",
              "position": 1,
              "name": "Главная",
              "item": "{{ request.scheme }}://{{ request.get_host }}{% url 'home' %}"
            },
            {
              "@type": "ListItem",
              "position": 2,
              "name": "Блог",
              "item": "{{ request.scheme }}://{{ request.get_host }}{% url 'post_list' %}"
            },
            {
              "@type": "ListItem",
              "position": 3,
              "name": "{{ post.category.name }}",
              "item": "{{ request.scheme }}://{{ request.get_host }}{% url 'post_list' %}?category={{ post.category.slug }}"
            },
            {
              "@type": "ListItem",
              "position": 4,
              "name": "{{ post.title }}",
              "item": "{{ request.scheme }}://{{ request.get_host }}{{ post.get_absolute_url }}"
            }
          ]
        }
    </script>
{% endblock %}

{% block content %}
    <style>
        .blog-content {
            text-align: justify;
        }

        .blog-content h1 {
            font-size: 2rem;
            font-weight: 500;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
        }

        .blog-content h2 {
            font-size: 1.5rem;
            font-weight: 500;
            margin-top: 1.25rem;
            margin-bottom: 0.75rem;
        }

        .blog-content h3 {
            font-size: 1.5rem;
            font-weight: 400;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
        }

        .blog-content h4 {
            font-size: 1.25rem;
            font-weight: 300;
            margin-top: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .blog-content h5, .blog-content h6 {
            font-size: 1.125rem;
            font-weight: 200;
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .blog-content p {
            margin-bottom: 1rem;
            line-height: 1.7;
        }

        .blog-content ul, .blog-content ol {
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }

        .blog-content ul {
            list-style-type: disc;
        }

        .blog-content ol {
            list-style-type: decimal;
        }

        .blog-content li {
            margin-bottom: 0.5rem;
        }

        .blog-content blockquote {
            border-left: 4px solid #818cf8;
            padding-left: 1rem;
            margin-left: 0;
            margin-right: 0;
            font-style: italic;
            color: #4b5563;
        }

        .blog-content img {
            max-width: 100%;
            height: auto;
            border-radius: 0.5rem;
            margin: 1rem 0;
        }

        .blog-content pre, .blog-content code {
            background-color: #f3f4f6;
            border-radius: 0.25rem;
            padding: 0.5rem;
            font-family: monospace;
            overflow-x: auto;
        }
    </style>
    <!-- Заголовок статьи с градиентным фоном -->
    <section
            class="pt-32 pb-20 bg-gradient-to-r from-indigo-600 via-indigo-600 to-purple-600 text-white relative overflow-hidden">
        <!-- Декоративные элементы -->
        <div class="absolute top-0 left-0 w-full h-full overflow-hidden opacity-10">
            <div class="absolute -top-40 -left-40 w-80 h-80 bg-white rounded-full"></div>
            <div class="absolute top-20 right-10 w-40 h-40 bg-white rounded-full"></div>
            <div class="absolute bottom-10 left-20 w-60 h-60 bg-white rounded-full"></div>
            <div class="absolute -bottom-20 right-20 w-80 h-80 bg-white rounded-full"></div>
        </div>
        <div class="container mx-auto px-4 relative z-10">
            <div class="max-w-4xl mx-auto text-center">
                <div class="mb-4 transform hover:scale-105 transition-transform duration-300">
                    <a href="{% url 'post_list' %}?category={{ post.category.slug }}"
                       class="inline-block bg-white text-indigo-600 text-sm font-medium py-1 px-4 rounded-full hover:bg-indigo-50 transition-colors duration-300">
                        {{ post.category.name }}
                    </a>
                </div>
                <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold leading-tight mb-6">{{ post.title }}</h1>
                <div class="flex items-center justify-center text-indigo-100 space-x-4">
                    <span class="flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none"
                             stroke="currentColor"
                             viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round"
                                  stroke-linejoin="round"
                                  stroke-width="2"
                                  d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        {{ post.created_at|date:"d.m.Y" }}
                    </span>
                    <span class="flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none"
                             stroke="currentColor"
                             viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round"
                                  stroke-linejoin="round"
                                  stroke-width="2"
                                  d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        {% with word_count=post.content|striptags|wordcount %}
                            {% widthratio word_count 200 1 as reading_time_raw %}
                            {% with reading_time=reading_time_raw|default:"1" %}
                                {{ reading_time }} мин. чтения
                            {% endwith %}
                        {% endwith %}
                    </span>
                    <span class="flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none"
                             stroke="currentColor"
                             viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round"
                                  stroke-linejoin="round"
                                  stroke-width="2"
                                  d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                        {{ post.author.get_full_name }}
                    </span>
                </div>
            </div>
        </div>
    </section>

    <!-- Раздел хлебных крошек -->
    <section class="pt-8 pb-4 md:pt-12 md:pb-8">
        <div class="container mx-auto px-4">
            <nav class="flex" aria-label="Breadcrumb">
                <ol class="inline-flex items-center space-x-1 md:space-x-3">
                    <li class="inline-flex items-center">
                        <a href="{% url 'home' %}"
                           class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-indigo-600">
                            <svg class="w-4 h-4 mr-2" fill="none"
                                 stroke="currentColor" viewBox="0 0 24 24"
                                 xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round"
                                      stroke-linejoin="round" stroke-width="2"
                                      d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                            </svg>
                            Главная
                        </a>
                    </li>
                    <li>
                        <div class="flex items-center">
                            <svg class="w-6 h-6 text-gray-400"
                                 fill="currentColor" viewBox="0 0 20 20"
                                 xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                      d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
                                      clip-rule="evenodd"></path>
                            </svg>
                            <a href="{% url 'post_list' %}"
                               class="ml-1 text-sm font-medium text-gray-700 hover:text-indigo-600">
                                Блог
                            </a>
                        </div>
                    </li>
                    <li>
                        <div class="flex items-center">
                            <svg class="w-6 h-6 text-gray-400"
                                 fill="currentColor" viewBox="0 0 20 20"
                                 xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                      d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
                                      clip-rule="evenodd"></path>
                            </svg>
                            <a href="{% url 'post_list' %}?category={{ post.category.slug }}"
                               class="ml-1 text-sm font-medium text-gray-700 hover:text-indigo-600">
                                {{ post.category.name }}
                            </a>
                        </div>
                    </li>
                    <li>
                        <div class="flex items-center">
                            <svg class="w-6 h-6 text-gray-400"
                                 fill="currentColor" viewBox="0 0 20 20"
                                 xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                      d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
                                      clip-rule="evenodd"></path>
                            </svg>
                            <span class="ml-1 text-sm font-medium text-indigo-600">{{ post.title|truncatechars:40 }}</span>
                        </div>
                    </li>
                </ol>
            </nav>
        </div>
    </section>

    <!-- Контент статьи -->
    <section class="py-8 md:py-12">
        <div class="container mx-auto px-4">
            <div class="flex flex-col lg:flex-row">
                <!-- Основной контент -->
                <div class="lg:w-2/3 lg:pr-10">
                    <!-- Оглавление статьи (автоматически генерируемое) -->
                    <div class="mb-8 p-6 bg-indigo-50 rounded-xl shadow-sm border border-indigo-100">
                        <h2 class="text-xl font-bold mb-4 flex items-center text-indigo-700">
                            <svg class="w-5 h-5 mr-2" fill="none"
                                 stroke="currentColor" viewBox="0 0 24 24"
                                 xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round"
                                      stroke-linejoin="round" stroke-width="2"
                                      d="M4 6h16M4 12h16M4 18h7"></path>
                            </svg>
                            Содержание
                        </h2>
                        <div class="post-toc">
                            <!-- JavaScript будет генерировать оглавление здесь -->
                        </div>
                    </div>

                    <!-- Изображение статьи с эффектами -->
                    <div class="mb-10 rounded-xl overflow-hidden shadow-xl relative group">
                        <img src="{{ post.featured_image.url }}"
                             alt="{{ post.title }}"
                             class="w-full h-auto transform group-hover:scale-105 transition-transform duration-700">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/30 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                    </div>

                    <!-- Контент статьи -->
                    {#                    <div class="prose prose-lg max-w-none mb-10 bg-white p-8 rounded-xl shadow-md" id="post-content">#}
                    <div class="blog-content mb-10 bg-white p-8 rounded-xl shadow-md"
                         id="post-content">
                        {{ post.content|safe }}
                    </div>

                    <!-- Теги -->
                    {% if post.tags.all %}
                        <div class="mb-10">
                            <h4 class="text-lg font-bold mb-4">Теги:</h4>
                            <div class="flex flex-wrap gap-2">
                                {% for tag in post.tags.all %}
                                    <a href="{% url 'post_list' %}?tag={{ tag.slug }}"
                                       class="bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm hover:bg-indigo-100 hover:text-indigo-700 transition-colors duration-300 transform hover:-translate-y-1">
                                        #{{ tag.name }}
                                    </a>
                                {% endfor %}
                            </div>
                        </div>
                    {% endif %}

                    <!-- Поделиться статьей -->
                    <div class="mb-10 p-6 bg-white rounded-xl shadow-md">
                        <h4 class="text-lg font-bold mb-4">Поделиться
                            статьей:</h4>
                        <div class="flex flex-wrap gap-2">
                            <button id="share-twitter"
                                    class="flex items-center px-3 py-1.5 bg-blue-400 text-white text-sm rounded-lg hover:bg-blue-500 transition-colors duration-300">
                                <svg class="w-4 h-4 mr-1.5" fill="currentColor"
                                     viewBox="0 0 24 24"
                                     xmlns="http://www.w3.org/2000/svg">
                                    <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723 10.1 10.1 0 01-3.127 1.195 4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
                                </svg>
                                Twitter
                            </button>
                            <button id="share-vk"
                                    class="flex items-center px-3 py-1.5 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition-colors duration-300">
                                <svg class="w-4 h-4 mr-1.5" fill="currentColor"
                                     viewBox="0 0 24 24"
                                     xmlns="http://www.w3.org/2000/svg">
                                    <path d="M21.547 7h-3.29a.743.743 0 0 0-.655.392s-1.312 2.416-1.734 3.23c-1.08 2.1-1.515 2.214-1.698 2.082-.414-.298-.301-1.2-.301-1.836V7.692c0-.654-.187-.921-.729-.921H10.38c-.4 0-.644.184-.644.46 0 .48.729.59.803 1.937v2.93c0 .642-.116.753-.373.753-.68 0-2.336-2.365-3.318-5.07-.192-.538-.381-.75-.98-.75H3.175c-.619 0-.743.28-.743.591 0 .622.681 3.718 3.173 7.812C7.728 18.64 10.38 20 12.774 20c1.409 0 1.583-.3 1.583-.814v-1.88c0-.6.128-.718.558-.718.316 0 .86.159 2.129 1.306 1.45 1.37 1.689 1.986 2.51 1.986h3.29c.618 0 .93-.31.753-.925-.195-.615-.9-1.506-1.84-2.565-.51-.57-1.273-1.186-1.507-1.493-.316-.407-.225-.586 0-.95 0 0 2.342-3.116 2.588-4.177.18-.602 0-.928-.632-.928z"/>
                                </svg>
                                ВК
                            </button>
                            <button id="share-linkedin"
                                    class="flex items-center px-3 py-1.5 bg-blue-700 text-white text-sm rounded-lg hover:bg-blue-800 transition-colors duration-300">
                                <svg class="w-4 h-4 mr-1.5" fill="currentColor"
                                     viewBox="0 0 24 24"
                                     xmlns="http://www.w3.org/2000/svg">
                                    <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                                </svg>
                                LI
                            </button>
                            <button id="share-telegram"
                                    class="flex items-center px-3 py-1.5 bg-blue-500 text-white text-sm rounded-lg hover:bg-blue-600 transition-colors duration-300">
                                <svg class="w-4 h-4 mr-1.5" fill="currentColor"
                                     viewBox="0 0 24 24"
                                     xmlns="http://www.w3.org/2000/svg">
                                    <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.96 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.244-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
                                </svg>
                                TG
                            </button>
                            <button id="copy-link"
                                    class="flex items-center px-3 py-1.5 bg-gray-600 text-white text-sm rounded-lg hover:bg-gray-700 transition-colors duration-300">
                                <svg class="w-4 h-4 mr-1.5" fill="none"
                                     stroke="currentColor" viewBox="0 0 24 24"
                                     xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round"
                                          stroke-linejoin="round"
                                          stroke-width="2"
                                          d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
                                </svg>
                                Копировать
                            </button>
                        </div>
                    </div>

                    <!-- Навигация по статьям -->
                    <div class="border-t border-b border-gray-200 py-8 mb-10">
                        <div class="flex flex-col md:flex-row justify-between">
                            <a href="{% url 'post_list' %}"
                               class="inline-flex items-center text-indigo-600 hover:text-indigo-800 transition-colors duration-300 mb-4 md:mb-0 group">
                                <svg class="w-5 h-5 mr-2 group-hover:-translate-x-1 transition-transform duration-300"
                                     fill="none" stroke="currentColor"
                                     viewBox="0 0 24 24"
                                     xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round"
                                          stroke-linejoin="round"
                                          stroke-width="2"
                                          d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                                </svg>
                                Назад к блогу
                            </a>
                            <div class="flex space-x-4">
                                <button id="share-btn"
                                        class="inline-flex items-center text-gray-600 hover:text-indigo-600 transition-colors duration-300 group">
                                    <svg class="w-5 h-5 mr-2" fill="none"
                                         stroke="currentColor"
                                         viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round"
                                              stroke-linejoin="round"
                                              stroke-width="2"
                                              d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path>
                                    </svg>
                                    Поделиться
                                </button>
                                <button type="button"
                                        class="inline-flex items-center text-gray-600 hover:text-indigo-600 transition-colors duration-300 print:hidden"
                                        onclick="window.print()">
                                    <svg class="w-5 h-5 mr-2" fill="none"
                                         stroke="currentColor"
                                         viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round"
                                              stroke-linejoin="round"
                                              stroke-width="2"
                                              d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
                                    </svg>
                                    Распечатать
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Комментарии с улучшенным дизайном -->
                    <div id="comments" class="mb-10">
                        <h3 class="text-2xl font-bold mb-6 flex items-center">
                            <svg class="w-6 h-6 mr-2 text-indigo-600"
                                 fill="none" stroke="currentColor"
                                 viewBox="0 0 24 24"
                                 xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round"
                                      stroke-linejoin="round" stroke-width="2"
                                      d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
                            </svg>
                            Комментарии ({{ comments.count }})
                        </h3>

                        {% if comments %}
                            <div class="space-y-6 mb-10">
                                {% for comment in comments %}
                                    <div class="bg-gray-50 p-6 rounded-xl shadow-sm hover:shadow-md transition-shadow duration-300">
                                        <div class="flex items-start">
                                            <div class="bg-indigo-100 text-indigo-600 w-10 h-10 rounded-full flex items-center justify-center font-bold mr-3 flex-shrink-0">
                                                {{ comment.name|first|upper }}
                                            </div>
                                            <div class="flex-grow">
                                                <div class="flex items-center justify-between mb-2">
                                                    <h4 class="font-bold">{{ comment.name }}</h4>
                                                    <p class="text-gray-500 text-sm">{{ comment.created_at|date:"d.m.Y H:i" }}</p>
                                                </div>
                                                <p class="text-gray-700">{{ comment.content }}</p>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="mb-10 bg-indigo-50 p-6 rounded-xl text-center">
                                <svg class="w-12 h-12 text-indigo-400 mx-auto mb-4"
                                     fill="none" stroke="currentColor"
                                     viewBox="0 0 24 24"
                                     xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round"
                                          stroke-linejoin="round"
                                          stroke-width="2"
                                          d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                                </svg>
                                <p class="text-gray-600 text-lg">Будьте первым,
                                    кто оставит комментарий!</p>
                            </div>
                        {% endif %}

                        <!-- Форма комментария с улучшенным дизайном -->
                        <div class="bg-white p-8 rounded-xl shadow-md">
                            <h4 class="text-xl font-bold mb-6 flex items-center">
                                <svg class="w-5 h-5 mr-2 text-indigo-600"
                                     fill="none" stroke="currentColor"
                                     viewBox="0 0 24 24"
                                     xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round"
                                          stroke-linejoin="round"
                                          stroke-width="2"
                                          d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                </svg>
                                Оставить комментарий
                            </h4>
                            <form method="post" action="" class="space-y-6">
                                {% csrf_token %}
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label for="{{ comment_form.name.id_for_label }}"
                                               class="block text-gray-700 font-medium mb-2">Ваше
                                            имя *</label>
                                        {{ comment_form.name }}
                                        {% if comment_form.name.errors %}
                                            <p class="text-red-500 text-sm mt-1">{{ comment_form.name.errors|join:", " }}</p>
                                        {% endif %}
                                    </div>
                                    <div>
                                        <label for="{{ comment_form.email.id_for_label }}"
                                               class="block text-gray-700 font-medium mb-2">Email
                                            *</label>
                                        {{ comment_form.email }}
                                        {% if comment_form.email.errors %}
                                            <p class="text-red-500 text-sm mt-1">{{ comment_form.email.errors|join:", " }}</p>
                                        {% endif %}
                                    </div>
                                </div>
                                <div>
                                    <label for="{{ comment_form.content.id_for_label }}"
                                           class="block text-gray-700 font-medium mb-2">Комментарий
                                        *</label>
                                    {{ comment_form.content }}
                                    {% if comment_form.content.errors %}
                                        <p class="text-red-500 text-sm mt-1">{{ comment_form.content.errors|join:", " }}</p>
                                    {% endif %}
                                </div>
                                <div>
                                    {{ comment_form.captcha }}
                                    {% if comment_form.captcha.errors %}
                                        <p class="text-red-500 text-sm mt-1">{{ comment_form.captcha.errors|join:", " }}</p>
                                    {% endif %}
                                </div>
                                <button type="submit"
                                        class="bg-indigo-600 text-white font-medium py-3 px-6 rounded-lg hover:bg-indigo-700 transition-colors duration-300 flex items-center">
                                    <svg class="w-5 h-5 mr-2" fill="none"
                                         stroke="currentColor"
                                         viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round"
                                              stroke-linejoin="round"
                                              stroke-width="2"
                                              d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                                    </svg>
                                    Отправить комментарий
                                </button>
                                <p class="text-gray-500 text-sm mt-3">*
                                    Комментарий будет опубликован после
                                    модерации</p>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Сайдбар с улучшенным дизайном -->
                <div class="lg:w-1/3 lg:pl-10 mt-10 lg:mt-0">
                    <!-- Автор статьи с карточкой в стиле главной страницы -->
                    <!-- Обновленный блок об авторе -->
                    <div class="bg-white p-6 rounded-xl shadow-md mb-8 hover:shadow-lg transition-all duration-300 overflow-hidden relative group">
                        <!-- Декоративный элемент -->
                        <div class="absolute -top-12 -right-12 w-24 h-24 bg-indigo-50 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>

                        <h3 class="text-xl font-bold mb-6 pb-3 border-b border-gray-200 flex items-center text-indigo-700">
                            <svg class="w-5 h-5 mr-2 text-indigo-600"
                                 fill="none" stroke="currentColor"
                                 viewBox="0 0 24 24"
                                 xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round"
                                      stroke-linejoin="round" stroke-width="2"
                                      d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                            Об авторе
                        </h3>

                        <div class="flex items-start">
                            <!-- Аватар автора - использует инициалы или фото, если есть -->
                            {% if post.author.profile.photo %}
                                <img src="{{ post.author.profile.photo.url }}"
                                     alt="{{ post.author.get_full_name }}"
                                     class="w-20 h-20 rounded-full object-cover mr-4 shadow-md">
                            {% else %}
                                <div class="w-20 h-20 bg-gradient-to-br from-indigo-500 to-purple-600 text-white rounded-full flex items-center justify-center text-xl font-bold mr-4 shadow-md">
                                    {{ post.author.first_name|first|upper }}{{ post.author.last_name|first|upper }}
                                </div>
                            {% endif %}

                            <div class="flex-1">
                                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-2">
                                    <h4 class="font-bold text-lg text-indigo-700">{{ post.author.get_full_name }}</h4>

                                    <!-- Социальные сети (если указаны в профиле) -->
                                    <div class="flex space-x-2 mt-2 sm:mt-0">
                                        {% if post.author.profile.linkedin_url %}
                                            <a href="{{ post.author.profile.linkedin_url }}"
                                               target="_blank"
                                               rel="noopener noreferrer"
                                               class="text-gray-500 hover:text-indigo-600 transition-colors duration-300">
                                                <svg class="w-5 h-5"
                                                     fill="currentColor"
                                                     viewBox="0 0 24 24"
                                                     xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                                                </svg>
                                            </a>
                                        {% endif %}

                                        {% if post.author.profile.twitter_url %}
                                            <a href="{{ post.author.profile.twitter_url }}"
                                               target="_blank"
                                               rel="noopener noreferrer"
                                               class="text-gray-500 hover:text-indigo-600 transition-colors duration-300">
                                                <svg class="w-5 h-5"
                                                     fill="currentColor"
                                                     viewBox="0 0 24 24"
                                                     xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723 10.1 10.1 0 01-3.127 1.195 4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
                                                </svg>
                                            </a>
                                        {% endif %}

                                        {% if post.author.profile.github_url %}
                                            <a href="{{ post.author.profile.github_url }}"
                                               target="_blank"
                                               rel="noopener noreferrer"
                                               class="text-gray-500 hover:text-indigo-600 transition-colors duration-300">
                                                <svg class="w-5 h-5"
                                                     fill="currentColor"
                                                     viewBox="0 0 24 24"
                                                     xmlns="http://www.w3.org/2000/svg">
                                                    <path fill-rule="evenodd"
                                                          clip-rule="evenodd"
                                                          d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/>
                                                </svg>
                                            </a>
                                        {% endif %}

                                        {% if post.author.profile.website_url %}
                                            <a href="{{ post.author.profile.website_url }}"
                                               target="_blank"
                                               rel="noopener noreferrer"
                                               class="text-gray-500 hover:text-indigo-600 transition-colors duration-300">
                                                <svg class="w-5 h-5"
                                                     fill="none"
                                                     stroke="currentColor"
                                                     viewBox="0 0 24 24"
                                                     xmlns="http://www.w3.org/2000/svg">
                                                    <path stroke-linecap="round"
                                                          stroke-linejoin="round"
                                                          stroke-width="2"
                                                          d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"></path>
                                                </svg>
                                            </a>
                                        {% endif %}
                                    </div>
                                </div>

                                <p class="text-gray-700 mb-3">
                                    {{ post.author.profile.position|default:"Эксперт по digital-маркетингу" }}
                                    {% if post.author.profile.company %}
                                        в {{ post.author.profile.company }}
                                    {% endif %}
                                </p>

                                <div class="text-gray-700 prose-sm mb-4">
                                    {{ post.author.profile.bio|default:"Автор статей и эксперт в области digital-маркетинга. Делится практическими знаниями и опытом в создании эффективных digital-стратегий." }}
                                </div>

                                <!-- Статистика автора -->
                                <div class="flex flex-wrap gap-3 text-sm text-gray-600">
                                    <div class="flex items-center">
                                        <svg class="w-4 h-4 mr-1 text-indigo-500"
                                             fill="none" stroke="currentColor"
                                             viewBox="0 0 24 24"
                                             xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round"
                                                  stroke-linejoin="round"
                                                  stroke-width="2"
                                                  d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                                        </svg>
                                        <span>{{ post.author.blog_posts.count }} статей</span>
                                    </div>

                                    <div class="flex items-center">
                                        <svg class="w-4 h-4 mr-1 text-indigo-500"
                                             fill="none" stroke="currentColor"
                                             viewBox="0 0 24 24"
                                             xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round"
                                                  stroke-linejoin="round"
                                                  stroke-width="2"
                                                  d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                        </svg>
                                        <span>В команде с {{ post.author.date_joined|date:"Y" }} года</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Кнопка "Все статьи автора" -->
                        <div class="mt-4 pt-4 border-t border-gray-100">
                            <a href="{% url 'post_list' %}?author={{ post.author.id }}"
                               class="inline-flex items-center text-indigo-600 hover:text-indigo-800 transition-colors duration-300 group">
                                <span>Все статьи автора</span>
                                <svg class="w-4 h-4 ml-1 group-hover:translate-x-1 transition-transform duration-300"
                                     fill="none" stroke="currentColor"
                                     viewBox="0 0 24 24"
                                     xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round"
                                          stroke-linejoin="round"
                                          stroke-width="2"
                                          d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
                                </svg>
                            </a>
                        </div>
                    </div>

                    <!-- Блок других статей автора - добавьте этот код в sidebar сразу после блока с информацией об авторе -->
                    {% if author_posts %}
                        <div class="bg-white p-6 rounded-xl shadow-md mb-8 hover:shadow-lg transition-all duration-300">
                            <h3 class="text-xl font-bold mb-6 pb-3 border-b border-gray-200 flex items-center">
                                <svg class="w-5 h-5 mr-2 text-indigo-600"
                                     fill="none" stroke="currentColor"
                                     viewBox="0 0 24 24"
                                     xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round"
                                          stroke-linejoin="round"
                                          stroke-width="2"
                                          d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"></path>
                                </svg>
                                Другие статьи автора
                            </h3>

                            <div class="space-y-4">
                                {% for author_post in author_posts %}
                                    <div class="group flex gap-3 hover:bg-gray-50 p-2 rounded-lg transition-colors duration-300">
                                        {% if author_post.featured_image %}
                                            <div class="w-16 h-16 overflow-hidden rounded-lg flex-shrink-0">
                                                <img src="{{ author_post.featured_image.url }}"
                                                     alt="{{ author_post.title }}"
                                                     class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300">
                                            </div>
                                        {% else %}
                                            <div class="w-16 h-16 bg-indigo-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                                <svg class="w-8 h-8 text-indigo-600"
                                                     fill="none"
                                                     stroke="currentColor"
                                                     viewBox="0 0 24 24"
                                                     xmlns="http://www.w3.org/2000/svg">
                                                    <path stroke-linecap="round"
                                                          stroke-linejoin="round"
                                                          stroke-width="2"
                                                          d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"></path>
                                                </svg>
                                            </div>
                                        {% endif %}

                                        <div class="flex-1">
                                            <a href="{{ author_post.get_absolute_url }}"
                                               class="block group">
                                                <h4 class="font-medium text-gray-800 group-hover:text-indigo-600 transition-colors duration-300 line-clamp-2">{{ author_post.title }}</h4>
                                                <div class="flex items-center mt-1 text-xs text-gray-500">
                                                    <span>{{ author_post.created_at|date:"d.m.Y" }}</span>
                                                    <span class="mx-1">•</span>
                                                    <span>
                            {% with word_count=author_post.content|striptags|wordcount %}
                                {% widthratio word_count 200 1 as reading_time_raw %}
                                {% with reading_time=reading_time_raw|default:"1" %}
                                    {{ reading_time }} мин. чтения
                                {% endwith %}
                            {% endwith %}
                        </span>
                                                </div>
                                            </a>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>

                            <div class="mt-4 pt-4 border-t border-gray-100 text-center">
                                <a href="{% url 'post_list' %}?author={{ post.author.id }}"
                                   class="inline-flex items-center text-indigo-600 hover:text-indigo-800 transition-colors duration-300 text-sm font-medium group">
                                    <span>Все статьи автора</span>
                                    <svg class="w-4 h-4 ml-1 group-hover:translate-x-1 transition-transform duration-300"
                                         fill="none" stroke="currentColor"
                                         viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round"
                                              stroke-linejoin="round"
                                              stroke-width="2"
                                              d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
                                    </svg>
                                </a>
                            </div>
                        </div>
                    {% endif %}

                    <!-- Похожие статьи с карточками -->
                    <div class="bg-white p-6 rounded-xl shadow-md mb-8 hover:shadow-lg transition-all duration-300">
                        <h3 class="text-xl font-bold mb-6 pb-3 border-b border-gray-200 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-indigo-600"
                                 fill="none" stroke="currentColor"
                                 viewBox="0 0 24 24"
                                 xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round"
                                      stroke-linejoin="round" stroke-width="2"
                                      d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            Похожие статьи
                        </h3>

                        {% if related_posts %}
                            <div class="space-y-6">
                                {% for related_post in related_posts %}
                                    <div class="group">
                                        <a href="{{ related_post.get_absolute_url }}"
                                           class="flex group-hover:bg-gray-50 p-2 rounded-lg transition-colors duration-300">
                                            <div class="w-20 h-20 rounded-lg overflow-hidden flex-shrink-0 mr-4">
                                                <img src="{{ related_post.featured_image.url }}"
                                                     alt="{{ related_post.title }}"
                                                     class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500">
                                            </div>
                                            <div>
                                                <h4 class="font-medium mb-1 group-hover:text-indigo-600 transition-colors duration-300 line-clamp-2">
                                                    {{ related_post.title }}
                                                </h4>
                                                <p class="text-gray-500 text-sm">{{ related_post.created_at|date:"d.m.Y" }}</p>
                                            </div>
                                        </a>
                                    </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <p class="text-gray-600">На данный момент нет
                                похожих статей.</p>
                        {% endif %}
                    </div>

                    <!-- Популярные теги -->
                    <div class="bg-white p-6 rounded-xl shadow-md mb-8 hover:shadow-lg transition-all duration-300">
                        <h3 class="text-xl font-bold mb-6 pb-3 border-b border-gray-200 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-indigo-600"
                                 fill="none" stroke="currentColor"
                                 viewBox="0 0 24 24"
                                 xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round"
                                      stroke-linejoin="round" stroke-width="2"
                                      d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
                            </svg>
                            Теги
                        </h3>
                        <div class="flex flex-wrap gap-2">
                            {% for tag in post.tags.all %}
                                <a href="{% url 'post_list' %}?tag={{ tag.slug }}"
                                   class="bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm hover:bg-indigo-100 hover:text-indigo-600 transition-colors duration-300">
                                    #{{ tag.name }}
                                </a>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Подписка на рассылку -->
                    <div class="bg-gradient-to-br from-indigo-600 to-purple-600 p-6 rounded-xl shadow-md text-white sticky"
                         style="top: 100px;">
                        <h3 class="text-xl font-bold mb-4">Подписка на
                            рассылку</h3>
                        <p class="mb-4 text-indigo-100">Получайте уведомления о
                            новых статьях и полезные материалы</p>
                        <form class="space-y-3">
                            <div>
                                <input type="email" placeholder="Ваш email"
                                       class="w-full px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-white text-gray-700 bg-white bg-opacity-90 placeholder-gray-400">
                            </div>
                            <button type="submit"
                                    class="w-full bg-white text-indigo-600 font-medium py-2 px-4 rounded-lg hover:bg-indigo-50 transition-colors duration-300">
                                Подписаться
                            </button>
                        </form>
                        <p class="mt-3 text-xs text-indigo-200">Нажимая на
                            кнопку, вы соглашаетесь с политикой
                            конфиденциальности</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Блок CTA (призыв к действию) -->
    <section
            class="py-16 bg-gradient-to-r from-indigo-600 to-purple-600 text-white relative overflow-hidden">
        <!-- Декоративные элементы -->
        <div class="absolute top-0 left-0 w-full h-full overflow-hidden opacity-10">
            <div class="absolute top-20 left-10 w-40 h-40 bg-white rounded-full"></div>
            <div class="absolute -bottom-20 right-20 w-80 h-80 bg-white rounded-full"></div>
        </div>
        <div class="container mx-auto px-4 relative z-10">
            <div class="max-w-3xl mx-auto text-center">
                <h2 class="text-3xl font-bold mb-6">Готовы начать работу с
                    профессионалами?</h2>
                <p class="text-xl text-indigo-100 mb-8">Свяжитесь с нами
                    сегодня, чтобы узнать, как мы можем помочь вашему бизнесу
                    расти в digital-пространстве.</p>
                <a href="{% url 'contact' %}"
                   class="inline-block px-8 py-3 bg-white text-indigo-600 font-medium rounded-lg hover:bg-indigo-50 transition-colors duration-300 transform hover:-translate-y-1 shadow-lg hover:shadow-xl">Связаться
                    с нами</a>
            </div>
        </div>
    </section>

    <!-- JavaScript для автоматического создания оглавления -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Функция для создания оглавления
            function generateTableOfContents() {
                const contentDiv = document.getElementById('post-content');
                const tocDiv = document.querySelector('.post-toc');

                if (!contentDiv || !tocDiv) return;

                const headings = contentDiv.querySelectorAll('h2, h3, h4');

                if (headings.length === 0) {
                    const tocSection = document.querySelector('.post-toc').closest('.mb-8');
                    if (tocSection) tocSection.style.display = 'none';
                    return;
                }

                const toc = document.createElement('ul');
                toc.className = 'space-y-2';

                headings.forEach((heading, index) => {
                    // Добавляем id к заголовку, если его нет
                    if (!heading.id) {
                        heading.id = 'heading-' + index;
                    }

                    const listItem = document.createElement('li');
                    const link = document.createElement('a');
                    link.href = '#' + heading.id;
                    link.textContent = heading.textContent;
                    link.className = 'hover:text-indigo-600 transition-colors duration-300';

                    // Добавляем отступ в зависимости от уровня заголовка
                    if (heading.tagName === 'H3') {
                        link.className += ' pl-4';
                    } else if (heading.tagName === 'H4') {
                        link.className += ' pl-8';
                    }

                    listItem.appendChild(link);
                    toc.appendChild(listItem);
                });

                tocDiv.appendChild(toc);
            }

            // Функции для обработки поделиться
            function setupShareButtons() {
                const url = encodeURIComponent(window.location.href);
                const title = encodeURIComponent(document.title);

                // Настройка кнопок соцсетей
                document.getElementById('share-twitter').addEventListener('click', function () {
                    window.open(`https://twitter.com/intent/tweet?url=${url}&text=${title}`, '_blank');
                });

                document.getElementById('share-vk').addEventListener('click', function () {
                    window.open(`https://vk.com/share.php?url=${url}&title=${title}`, '_blank');
                });

                document.getElementById('share-linkedin').addEventListener('click', function () {
                    window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${url}`, '_blank');
                });

                document.getElementById('share-telegram').addEventListener('click', function () {
                    window.open(`https://t.me/share/url?url=${url}&text=${title}`, '_blank');
                });

                // Кнопка копирования ссылки
                document.getElementById('copy-link').addEventListener('click', function () {
                    navigator.clipboard.writeText(window.location.href).then(function () {
                        const originalText = this.innerHTML;
                        this.innerHTML = `
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                            Ссылка скопирована
                        `;
                        setTimeout(() => {
                            this.innerHTML = originalText;
                        }, 2000);
                    }.bind(this));
                });
            }

            // Запуск функций
            generateTableOfContents();
            setupShareButtons();
        });
    </script>
{% endblock %}